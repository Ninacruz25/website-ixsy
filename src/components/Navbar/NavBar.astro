---
const pathname = new URL(Astro.request.url).pathname;
const isActive = (path) => {
  if (path === '/' && pathname === '/') return true;
  if (path !== '/' && pathname.startsWith(path)) return true;
  return false;
}

// Definir las secciones que están en el dropdown "Más"
const dropdownSections = [
  { path: '/comunnity/comunidad', name: 'Comunidad', label: 'Comunidad' },
  { path: '/membership/membresia', name: 'Servicios', label: 'Servicios' },
  // { path: '/contact', name: 'Contacto', label: 'Contacto' },
  { path: '/policy/politicas', name: 'Políticas', label: 'Políticas' },
  { path: '/fellows/fellows', name: 'IXSY Fellows', label: 'IXSY Fellows' },
  { path: '/recursos/recursos', name: 'Recursos', label: 'Recursos' }
];

// Encontrar si estamos en alguna sección del dropdown
const currentDropdownSection = dropdownSections.find(section => isActive(section.path));

// Filtrar las secciones del dropdown excluyendo la actual
const availableDropdownSections = dropdownSections.filter(section => !isActive(section.path));
---

<nav class="fixed w-full z-50 top-0">
  <div class="container mx-auto px-4">
    <div class="flex justify-between items-center">
      <!-- Logo -->
      <div class="flex items-center">
        <a href="/" class="flex items-center">
          <img src="/ixsy_logo_letras.svg" alt="Logo IXSY" class="mr-1" style="height: 120px;" /> 
        </a>
      </div>
      
      <!-- Desktop Navigation -->
      <div class="hidden md:block">
        <div class="bg-gray backdrop-blur-lg rounded-full px-2 py-2 shadow-lg border border-gray-700/50">
          <div class="flex items-center space-x-1">
            <a 
              href="/" 
              class={`px-6 py-3 rounded-full text-sm font-medium transition-all duration-300 ${
                isActive('/') 
                  ? 'bg-teal-500 text-white shadow-lg shadow-teal-500/25' 
                  : 'text-gray-300 hover:bg-gray-700/70 hover:text-white'
              }`}
            >
              Inicio
            </a>
            <a 
              href="/ixsy/ixsy" 
              class={`px-6 py-3 rounded-full text-sm font-medium transition-all duration-300 ${
                isActive('/ixsy/ixsy') 
                  ? 'bg-teal-500 text-white shadow-lg shadow-teal-500/25' 
                  : 'text-gray-300 hover:bg-gray-700/70 hover:text-white'
              }`}
            >
              IXSY
            </a>
            <a 
              href="/eventos/event" 
              class={`px-6 py-3 rounded-full text-sm font-medium transition-all duration-300 ${
                isActive('/eventos') 
                  ? 'bg-teal-500 text-white shadow-lg shadow-teal-500/25' 
                  : 'text-gray-300 hover:bg-gray-700/70 hover:text-white'
              }`}
            >
              Eventos
            </a>
            
            <!-- Mostrar sección actual del dropdown como ítem principal -->
            {currentDropdownSection && (
              <a 
                href={currentDropdownSection.path}
                class="bg-teal-500 text-white shadow-lg shadow-teal-500/25 px-6 py-3 rounded-full text-sm font-medium transition-all duration-300"
              >
                {currentDropdownSection.label}
              </a>
            )}
            
            <!-- Dropdown Menu (solo mostrar si hay secciones disponibles) -->
            {availableDropdownSections.length > 0 && (
              <div class="relative group">
                <button 
                  class="text-gray-300 hover:bg-gray-700/70 hover:text-white px-6 py-3 rounded-full text-sm font-medium transition-all duration-300 flex items-center"
                  id="dropdown-button"
                >
                  Más
                  <svg 
                    xmlns="http://www.w3.org/2000/svg" 
                    class="h-4 w-4 ml-2 transition-transform duration-200 group-hover:rotate-180" 
                    fill="none" 
                    viewBox="0 0 24 24" 
                    stroke="currentColor"
                  >
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
                  </svg>
                </button>
                
                <!-- Dropdown Content -->
                <div 
                  class="absolute right-0 mt-2 w-48 bg-gray-900/95 backdrop-blur-lg rounded-xl shadow-xl border border-gray-700/50 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 transform translate-y-2 group-hover:translate-y-0"
                  id="dropdown-menu"
                >
                  <div class="py-2">
                    {availableDropdownSections.map(section => (
                      <a 
                        href={section.path}
                        class="block px-4 py-3 text-sm transition-colors duration-200 text-gray-300 hover:bg-gray-800/70 hover:text-white"
                      >
                        {section.label}
                      </a>
                    ))}
                  </div>
                </div>
              </div>
            )}
          </div>
        </div>
      </div>
      
      <!-- Mobile menu button -->
      <div class="md:hidden">
        <button 
          type="button" 
          class="bg-gray-900/90 backdrop-blur-lg rounded-full p-3 text-gray-300 hover:text-white focus:outline-none border border-gray-700/50" 
          id="mobile-menu-button"
        >
          <svg class="h-5 w-5" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16" />
          </svg>
        </button>
      </div>
    </div>
    
    <!-- Mobile menu -->
    <div class="md:hidden mt-4 hidden" id="mobile-menu">
      <div class="bg-gray-900/95 backdrop-blur-lg rounded-2xl shadow-xl border border-gray-700/50 overflow-hidden">
        <div class="py-2">
          <a 
            href="/" 
            class={`block px-6 py-4 text-base font-medium transition-colors duration-200 ${
              isActive('/') 
                ? 'bg-teal-500 text-white' 
                : 'text-gray-300 hover:bg-gray-800/70 hover:text-white'
            }`}
          >
            Inicio
          </a>
          <a 
            href="/ixsy/ixsy" 
            class={`block px-6 py-4 text-base font-medium transition-colors duration-200 ${
              isActive('/ixsy/ixsy') 
                ? 'bg-teal-500 text-white' 
                : 'text-gray-300 hover:bg-gray-800/70 hover:text-white'
            }`}
          >
            IXSY
          </a>
          <a 
            href="/eventos/event" 
            class={`block px-6 py-4 text-base font-medium transition-colors duration-200 ${
              isActive('/eventos') 
                ? 'bg-teal-500 text-white' 
                : 'text-gray-300 hover:bg-gray-800/70 hover:text-white'
            }`}
          >
            Eventos
          </a>
          
          <!-- Mostrar sección actual del dropdown en móvil -->
          {currentDropdownSection && (
            <a 
              href={currentDropdownSection.path}
              class="block px-6 py-4 text-base font-medium transition-colors duration-200 bg-teal-500 text-white"
            >
              {currentDropdownSection.label}
            </a>
          )}
          
          <!-- Mobile Dropdown Section -->
          {availableDropdownSections.length > 0 && (
            <div class="border-t border-gray-700/50 mt-2 pt-2">
              {availableDropdownSections.map(section => (
                <a 
                  href={section.path}
                  class="block px-6 py-4 text-base font-medium transition-colors duration-200 text-gray-300 hover:bg-gray-800/70 hover:text-white"
                >
                  {section.label}
                </a>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
  // Esperar a que cargue completamente
  window.addEventListener('load', function() {
    
    // Función para el menú móvil
    function initMobileMenu() {
      const button = document.querySelector('#mobile-menu-button');
      const menu = document.querySelector('#mobile-menu');
      
      if (button && menu) {
        button.onclick = function() {
          menu.classList.toggle('hidden');
        };
        
        // Cerrar al hacer click fuera
        document.onclick = function(e) {
          if (menu && button) {
            const clickedButton = button.contains(e.target);
            const clickedMenu = menu.contains(e.target);
            
            if (!clickedButton && !clickedMenu && !menu.classList.contains('hidden')) {
              menu.classList.add('hidden');
            }
          }
        };
      }
    }
    
    // Función para el dropdown
    function initDropdown() {
      const button = document.querySelector('#dropdown-button');
      const menu = document.querySelector('#dropdown-menu');
      
      if (button && menu) {
        const container = button.parentNode;
        let timer;
        
        container.onmouseenter = function() {
          if (timer) clearTimeout(timer);
          menu.style.opacity = '1';
          menu.style.visibility = 'visible';
          menu.style.transform = 'translateY(0)';
        };
        
        container.onmouseleave = function() {
          timer = setTimeout(function() {
            menu.style.opacity = '0';
            menu.style.visibility = 'hidden';
            menu.style.transform = 'translateY(8px)';
          }, 150);
        };
      }
    }
    
    // Inicializar todo
    initMobileMenu();
    initDropdown();
    
  });
</script>

<style>
  /* Smooth animations */
  nav {
    animation: slideDown 0.5s ease-out;
  }
  
  @keyframes slideDown {
    from {
      transform: translateY(-100%);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }
  
  /* Glassmorphism effect enhancement */
  .backdrop-blur-lg {
    backdrop-filter: blur(16px);
    -webkit-backdrop-filter: blur(16px);
  }
</style>